---
- name: raspberry-pi
  hosts: all
  remote_user: &user pi
  become_method: sudo

  tasks:
    - name: Install apt packages
      apt:
        name: "{{packages}}"
        update_cache: true
      become: true
      vars:
        packages:
          - dnsutils
          - git
          - vim-tiny
          - zsh

    - name: Install zshrc
      copy:
        src: config/.zshrc
        dest: ~/.zshrc
        mode: 0644

    - name: Install oh-my-zsh
      git: repo=https://github.com/robbyrussell/oh-my-zsh.git dest=~/.oh-my-zsh

    - name: chsh to zsh
      user:
        name: *user
        shell: /usr/bin/zsh
      become: true

    - name: Check if docker installed
      ignore_errors: true
      register: docker_installed
      command: which docker

    - name: Download Docker install script
      get_url:
        url: https://get.docker.com
        dest: /tmp/get-docker.sh
        mode: 0755
      when: docker_installed is failed

    - name: Install Docker
      command: /tmp/get-docker.sh
      become: true
      when: docker_installed is failed
